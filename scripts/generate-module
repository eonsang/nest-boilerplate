#!/bin/bash

# âœ… ëª¨ë“ˆ ì´ë¦„ ì¸ì í™•ì¸
if [ -z "$1" ]; then
  echo "âŒ ëª¨ë“ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ì˜ˆ: ./generate-module.sh auth"
  exit 1
fi

MODULE=$1
CAP_MODULE="$(tr '[:lower:]' '[:upper:]' <<< ${MODULE:0:1})${MODULE:1}" # auth â†’ Auth
BASE_DIR=src/$MODULE

echo "ğŸš€ [$MODULE] ëª¨ë“ˆ êµ¬ì¡° ìƒì„± ì‹œì‘..."

# âœ… ë””ë ‰í† ë¦¬ ëª©ë¡ ì •ì˜
DIRS=(
  "$BASE_DIR/presentation/http/rest/dto"
  "$BASE_DIR/presentation/cron"
  "$BASE_DIR/presentation/queue"
  "$BASE_DIR/application/dto/req"
  "$BASE_DIR/application/dto/res"
  "$BASE_DIR/application/service"
  "$BASE_DIR/application/error"
  "$BASE_DIR/domain/entity"
  "$BASE_DIR/domain/service"
  "$BASE_DIR/domain/error"
  "$BASE_DIR/domain/repository"
  "$BASE_DIR/infra/repository"
  "$BASE_DIR/infra/api"
  "$BASE_DIR/infra/mapper"
  "$BASE_DIR/infra/queue"
)

# âœ… ë””ë ‰í† ë¦¬ ìƒì„± + index.ts ì¶”ê°€
for dir in "${DIRS[@]}"; do
  mkdir -p "$dir"
  touch "$dir/index.ts"
done


# âœ… controller ìƒì„±
cat <<EOF > "$BASE_DIR/presentation/http/rest/${MODULE}.controller.ts"
import { Controller, Get } from '@nestjs/common';
@Controller('${MODULE}')
export class ${CAP_MODULE}Controller {
  @Get()
  register() {
    return { message: 'Ok' };
  }
}
EOF

# âœ… module.ts ìƒì„±
cat <<EOF > "$BASE_DIR/${MODULE}.module.ts"
import { Module } from '@nestjs/common';
import { ${CAP_MODULE}Controller } from './presentation/http/rest/${MODULE}.controller';
@Module({
  imports: [],
  providers: [],
  controllers: [${CAP_MODULE}Controller],
  exports: [],
})
export class ${CAP_MODULE}Module {}
EOF

echo "âœ… [$MODULE] ëª¨ë“ˆ ìƒì„± ì™„ë£Œ! ğŸ‰"